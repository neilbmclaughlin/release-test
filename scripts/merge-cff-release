#!/bin/bash

set -e

VERSION=$1
RELEASE_BRANCH="release/$VERSION"
RELEASE_NOTES_FILE="./release-docs/CFF-${VERSION}.md"

echo "Merging branch $RELEASE_BRANCH into master and development and publishing release $VERSION"
echo "Hit return to continue"
read

git switch $RELEASE_BRANCH
git pull

git switch master
git pull
git merge --ff-only $RELEASE_BRANCH
git push
git tag -a $VERSION -m 'Release $VERSION'
git push --tags

gh release edit $VERSION --draft=false --tag $VERSION --verify-tag --notes "[release notes](/$RELEASE_NOTES_FILE)"

git switch development
git pull
git merge --ff-only $RELEASE_BRANCH
git push
